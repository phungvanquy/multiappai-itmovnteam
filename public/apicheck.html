<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>MultiAppAI - ITMOvnteam</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <style>
      body {
        height: 100vh;
        background: radial-gradient(ellipse at top left, #122920 25%, #08140e 100%);
        color: #05ff7a;
        font-family: 'Fira Mono', 'Courier New', Courier, monospace;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #main-wrap {
        width: 100%;
        min-height: 60vh;
        max-width: 430px;
        background: rgba(19,40,32,0.99);
        border-radius: 18px;
        box-shadow: 0 4px 36px #00ff9495, 0 1px 20px #012e1370;
        padding: 38px 20px 28px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      h1.blinking-cursor {
        color: #aaffd6;
        letter-spacing: 0.5px;
        font-size: 1.7rem;
        font-weight: 700;
        margin: 0 0 12px 0;
        text-shadow: 0 0 8px #28ffb1bb;
        white-space: pre-line;
        align-self: center;
      }
      .desc-text {
        color: #adfed6;
        margin-bottom: 21px;
        font-size: 1rem;
        text-align: center;
      }
      form#userForm {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 13px;
        position: relative;
      }
      .input-wrap {
        display: flex;
        align-items: center;
        gap: 0;
        background: #162c25;
        border-radius: 6px;
        border: 2px solid #13e3a0;
        box-shadow: 0 1px 2.5px #25f8c94a inset;
      }
      .user-input-icon {
        margin-left: 12px;
        color: #1bf492cc;
        font-size: 1.08em;
      }
      input#userName {
        flex: 1;
        background: transparent;
        border: none;
        color: #05f4ac;
        font-size: 1.09em;
        padding: 11px 10px;
        outline: none;
      }
      input#userName::placeholder {
        color: #73e7b3cc;
      }
      input#userName:focus {
        background: #183536;
      }
      button#submitButton {
        background: linear-gradient(90deg, #18ff8a 0, #01a674 100%);
        color: #10281c;
        padding: 10px;
        border: none;
        border-radius: 7px;
        font-size: 1.08em;
        font-weight: 600;
        margin-top: 6px;
        box-shadow: 0 0 4.5px #0affb7bb;
        transition: background 0.2s, transform 0.15s;
        cursor: pointer;
        display: flex;
        gap: 7px;
        align-items: center;
        justify-content: center;
      }
      button#submitButton:hover, button#submitButton:active {
        background: linear-gradient(90deg, #53fbbc 10%, #018a60 100%);
        color: #fff;
        transform: scale(1.025);
      }
      .cf-turnstile {
        display: flex;
        justify-content: center;
        margin: 7px auto 1px auto;
      }
      .notice {
        color: #daffe5;
        opacity: 0.90;
        font-size: 0.94em;
        margin: 13px auto 2px auto;
        text-align: center;
        line-height: 1.4;
      }
      #userInfo {
        margin-top: 22px;
        width: 100%;
        min-height: 36px;
        opacity: 0;
        transform: scale(0.97);
        transition: opacity 0.41s, transform 0.39s;
      }
      #userInfo.show {
        opacity: 1;
        transform: scale(1);
      }
      .error-message {
        background: #441514e0;
        color: #ff8e87;
        padding: 12px 12px;
        border-radius: 7px;
        font-weight: bold;
        font-size: 1em;
        text-align: center;
      }
      .main-info, .table-card {
        background: #134337f7;
        border-radius: 7px;
        box-shadow: 0 2px 11px #09a37e66;
        padding: 13px 10px 7px 10px;
        margin-bottom: 14px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 6px 0 0 0;
      }
      th, td {
        border-bottom: 1px solid #238d6688;
        padding: 8px 9px;
        color: #e7fff4;
        font-size: 0.98em;
        letter-spacing: 0.5px;
      }
      th {
        background: #20624bb2;
        color: #3ae6b0;
      }
      td {
        background: #13362a7a;
        color: #e2fff1;
      }
      .balance, .quota-val { color: #ffe884; font-weight: bold; }
      .request-count { color: #59ffcd; font-weight: bold; }
      .details-table-title {
        color: #9fffd6;
        margin: 8px 0 7px 0;
        text-align: left;
        font-size: 1.06em;
        font-weight: bold;
        letter-spacing: 1px;
      }
      .spinner {
        display: inline-block;
        width: 29px;height: 29px;
        border: 5px solid #31ffa1cc;
        border-radius: 50%;
        border-top: 5px solid #184839;
        animation: spin 0.7s linear infinite;
        margin: 29px auto 18px auto;
      }
      @keyframes spin {
        0% { transform: rotate(0deg);}
        100% {transform: rotate(360deg);}
      }
      h4 {
        color: #7effcb;
        margin: 26px 0 3px 0;
        letter-spacing: 1.5px;
        text-align: center;
        text-shadow: 0 2px 10px #23c49752;
      }
      @media (max-width: 500px) {
        #main-wrap { padding: 17px 2vw 13px 2vw; }
        h1.blinking-cursor {font-size: 1.08rem;}
        .main-info, .table-card, th, td {font-size: 0.92em;}
      }
      .blinking-cursor {
        border-right: 3px solid #69ffc9;
        animation: blink-caret 0.73s step-end infinite;
      }
      @keyframes blink-caret {
        from, to {border-color: transparent;}
        49% {border-color: #69ffc9;}
      }
    </style>
  </head>
  <body>
    <div id="main-wrap">
      <h1 id="brandName" class="blinking-cursor">MultiAppAI - ITMOvnteam</h1>
      <div class="desc-text">
        <i class="fa-solid fa-terminal"></i> Tra cứu thông tin sử dụng API
      </div>
      <form id="userForm" autocomplete="off">
        <div class="input-wrap">
          <span class="user-input-icon"><i class="fa-solid fa-user"></i></span>
          <input type="text" id="userName" placeholder="Tên đăng nhập..." autocomplete="off" required />
        </div>
        <button type="submit" id="submitButton">
          <i class="fas fa-search"></i> Tra cứu
        </button>
        <div class="cf-turnstile" data-sitekey="0x4AAAAAAA5GwptuLfkTNVnO"></div>
      </form>
      <div id="userInfo"></div>
      <div class="notice">
        <div>
          <i class="fa-solid fa-shield-halved"></i>
          CAPTCHA bảo vệ chống DDos.<br>
          Nếu bị lỗi xác minh, hãy nhấn F5 hoặc tải lại trang.<br>
        </div>
        <div style="margin-top:7px;">
          <i class="fa-solid fa-circle-info"></i>
          Thông tin các models chỉ lưu 1 tháng gần nhất.
        </div>
      </div>
      <h4>--- ITMOvnteam ---</h4>
    </div>
    <script>
      // Hiệu ứng tên thương hiệu
      const brandNameElement = document.getElementById("brandName");
      const originalText = "MultiAppAI - ITMOvnteam";
      const textWithoutM = "MultiAppAI - ITMOvntea";
      function toggleM() {
        setTimeout(() => {
          brandNameElement.textContent = textWithoutM;
          setTimeout(() => {
            brandNameElement.textContent = originalText;
            toggleM();
          }, 500);
        }, 2000);
      }
      toggleM();

      // Xử lý CAPTCHA
      let captchaResponse = null;
      async function preloadCaptcha() {
        try { captchaResponse = await turnstile.getResponse(); }
        catch (error) {/* ignore */}
      }
      preloadCaptcha();

      const userInfoDiv = document.getElementById("userInfo");
      const userForm = document.getElementById("userForm");

      // Loading spinner
      function showLoadingSpinner() {
        userInfoDiv.innerHTML = `<div style="text-align:center;"><span class="spinner"></span></div>`;
        userInfoDiv.classList.remove("show");
        setTimeout(()=>userInfoDiv.classList.add("show"), 50);
      }

      // Tự động ẩn sau 55s
      function startFadeOutTimer(element) {
        let fadeOutTimeout;
        const fadeOut = () => element.classList.remove("show");
        const resetFadeOut = () => {
          clearTimeout(fadeOutTimeout);
          element.classList.add("show");
          fadeOutTimeout = setTimeout(fadeOut, 55000);
        };
        element.addEventListener("mouseenter", () => {clearTimeout(fadeOutTimeout);});
        element.addEventListener("mouseleave", resetFadeOut);
        resetFadeOut();
      }

      userForm.addEventListener("submit", async function (event) {
        event.preventDefault();
        const userName = document.getElementById("userName").value.trim();
        if (!userName) return;
        showLoadingSpinner();
        await preloadCaptcha();
        try {
          const response = await fetch(
            `https://multiappai-api.itmovnteam.com/getinfor/user/${encodeURIComponent(userName)}?captcha_response=${captchaResponse}`,
            {method: "GET", headers: {"Content-Type": "application/json"}}
          );
          let data = await response.json();
          if (!response.ok) throw new Error(data.detail||"Server error");

          let quotaUSD = (data.user.quota / 500000).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
          let requestCount = data.user.request_count;
          let rows = '', valid = 0;
          for (const quota of (Array.isArray(data.model_quotas)?data.model_quotas:[])) {
            if (!quota.model_name || !quota.model_name.trim()) continue;
            valid += 1;
            let quotaVal = (quota.total_quota / 500000).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
            rows += `<tr>
              <td>${quota.model_name}</td>
              <td class="quota-val">${quotaVal}</td>
            </tr>`;
          }
          userInfoDiv.innerHTML = `
            <div class="main-info">
              <div class="details-table-title" style="margin-top:-6px;"><i class="fas fa-user-circle"></i> Thông tin tài khoản:</div>
              <table>
                <tr><th>Tài khoản</th><td class="balance">${data.user.username}</td></tr>
                <tr><th>Số dư</th><td class="balance"><i class="fa fa-dollar-sign"></i> ${quotaUSD}</td></tr>
                <tr><th>Lượt request</th><td class="request-count">${requestCount}</td></tr>
              </table>
            </div>
            <div class="table-card">
              <div class="details-table-title"><i class="fas fa-list"></i> Sử dụng từng model:</div>
              <table>
                <thead>
                  <tr>
                    <th>Model</th>
                    <th>Đã dùng (USD)</th>
                  </tr>
                </thead>
                <tbody>
                  ${valid ? rows : `<tr><td colspan="2" style="text-align:center;color:#90fae2;font-style:italic;">Không có dữ liệu sử dụng model</td></tr>`}
                </tbody>
              </table>
            </div>
          `;
          userInfoDiv.classList.add("show");
          startFadeOutTimer(userInfoDiv);
          turnstile.reset();
          preloadCaptcha();
        } catch (error) {
          userInfoDiv.innerHTML = `<div class="error-message"><i class="fa fa-triangle-exclamation"></i> ${error.message}</div>`;
          userInfoDiv.classList.add("show");
          startFadeOutTimer(userInfoDiv);
        }
      });
    </script>
  </body>
</html>
